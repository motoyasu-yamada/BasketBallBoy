function random(e,t){return e+Math.random()*(t-e)}var __reflect=this&&this.__reflect||function(e,t,r){e.__class__=t,r?r.push(t):r=[t],e.__types__=e.__types__?r.concat(e.__types__):r},__extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);r.prototype=t.prototype,e.prototype=new r},__awaiter=this&&this.__awaiter||function(e,t,r,i){return new(r||(r=Promise))(function(n,o){function a(e){try{c(i.next(e))}catch(t){o(t)}}function s(e){try{c(i["throw"](e))}catch(t){o(t)}}function c(e){e.done?n(e.value):new r(function(t){t(e.value)}).then(a,s)}c((i=i.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function r(e){return function(t){return i([e,t])}}function i(r){if(n)throw new TypeError("Generator is already executing.");for(;c;)try{if(n=1,o&&(a=o[2&r[0]?"return":r[0]?"throw":"next"])&&!(a=a.call(o,r[1])).done)return a;switch(o=0,a&&(r=[0,a.value]),r[0]){case 0:case 1:a=r;break;case 4:return c.label++,{value:r[1],done:!1};case 5:c.label++,o=r[1],r=[0];continue;case 7:r=c.ops.pop(),c.trys.pop();continue;default:if(a=c.trys,!(a=a.length>0&&a[a.length-1])&&(6===r[0]||2===r[0])){c=0;continue}if(3===r[0]&&(!a||r[1]>a[0]&&r[1]<a[3])){c.label=r[1];break}if(6===r[0]&&c.label<a[1]){c.label=a[1],a=r;break}if(a&&c.label<a[2]){c.label=a[2],c.ops.push(r);break}a[2]&&c.ops.pop(),c.trys.pop();continue}r=t.call(e,c)}catch(i){r=[6,i],o=0}finally{n=a=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}var n,o,a,s,c={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:r(0),"throw":r(1),"return":r(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},GameObject=function(){function e(e){void 0===e&&(e=null),this.toDelete=!1,this.inited=!1,e&&(this._name=e),GameWorld.addGameObject(this)}return Object.defineProperty(e.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),e.prototype.init=function(){this.resetDisplay(),this.inited=!0},e.prototype.resetDisplay=function(){this.display&&(GameWorld.displayObjectContainer.removeChild(this.display),this.display=null),this.display=this.createDisplay(),this.display&&GameWorld.displayObjectContainer.addChild(this.display)},e.prototype.createDisplay=function(){return null},e.prototype.update=function(){},e.prototype.markToDelete=function(){this.toDelete=!0},e.prototype["delete"]=function(){this.display&&GameWorld.displayObjectContainer.removeChild(this.display),this.display=null},e}();__reflect(GameObject.prototype,"GameObject");var PhysicsObject=function(e){function t(t){return void 0===t&&(t=null),e.call(this,t)||this}return __extends(t,e),Object.defineProperty(t.prototype,"id",{get:function(){return this.body.id},enumerable:!0,configurable:!0}),t.prototype.init=function(){this.body=new p2.Body(this.options()),this.addShapeToBody(),this.body.displays=[this.display],GameWorld.addPhysicsObject(this),e.prototype.init.call(this)},t.prototype.addShapeToBody=function(){var e=this.createShape();this.body.addShape(e)},t.prototype.createShape=function(){throw new Error("createShape or addShapeToBody must be implemented")},t.prototype.update=function(){var e=(this.body,this.display);e&&(e.x=this.egretX,e.y=this.egretY,e.rotation=this.egretAngel)},Object.defineProperty(t.prototype,"meterX",{get:function(){return this.body.position[0]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"meterY",{get:function(){return this.body.position[1]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"egretX",{get:function(){return GameWorld.xMeterToPixel(this.meterX)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"egretY",{get:function(){return GameWorld.yMeterToPixel(this.meterY)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"egretAngel",{get:function(){return 180*(this.body.angle+this.body.shapes[0].angle)/Math.PI},enumerable:!0,configurable:!0}),t.prototype["delete"]=function(){e.prototype["delete"].call(this),this.body&&(GameWorld.world.removeBody(this.body),this.body.displays=[],this.body=null)},t.prototype.onImpact=function(e){return!0},t.prototype.onEndContact=function(e,t,r){return!0},t.prototype.onBeginContact=function(e,t,r){return!0},t}(GameObject);__reflect(PhysicsObject.prototype,"PhysicsObject");var LoadingScene=function(e){function t(){var t=e.call(this)||this;return t.createView(),t}return __extends(t,e),t.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},t.prototype.onProgress=function(e,t){this.textField.text="Loading..."+e+"/"+t},t}(egret.Sprite);__reflect(LoadingScene.prototype,"LoadingScene",["RES.PromiseTaskReporter"]);var Main=function(e){function t(){var t=e.call(this)||this;return t.once(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t}return __extends(t,e),t.prototype.onAddToStage=function(e){return __awaiter(this,void 0,void 0,function(){var e,t,r=this;return __generator(this,function(i){switch(i.label){case 0:return e=function(){return __awaiter(r,void 0,void 0,function(){var e,t;return __generator(this,function(r){switch(r.label){case 0:return r.trys.push([0,3,,4]),e=new LoadingScene,this.stage.addChild(e),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return r.sent(),[4,RES.loadGroup("preload",0,e)];case 2:return r.sent(),SoundManager.init(),this.stage.removeChild(e),[3,4];case 3:return t=r.sent(),console.error(t),[3,4];case 4:return[2]}})})},[4,e()];case 1:return i.sent(),t=new TitleScene,this.stage.addChild(t),[2]}})})},t}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");var TitleScene=function(e){function t(){var t=e.call(this)||this;return t.addEventListener(eui.UIEvent.COMPLETE,t.uiCompHandler,t),t.skinName="resource/custom_skins/TitleScene.exml",t}return __extends(t,e),t.prototype.uiCompHandler=function(){var e=this;this.addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){SoundManager.playButtonPressed(),e.parent.addChild(new GameScene),e.parent.removeChild(e)},this)},t}(eui.Component);__reflect(TitleScene.prototype,"TitleScene",["eui.UIComponent","egret.DisplayObject"]);var Ball=function(e){function t(){var t=e.call(this,"Ball")||this;t.toUp=0,t.toPassBasket=0,t.toPassBasketSide=0,t.bx=GameWorld.stageWidthMeter/4;var r=RES.getRes("particle_png"),i=RES.getRes("particle_json");return t.particle=new particle.GravityParticleSystem(r,i),t}return __extends(t,e),t.prototype.options=function(){return{mass:1,force:[0,-300],position:[this.bx,GameWorld.stageHeightMeter/2]}},t.prototype.up=function(){this.toUp++},t.prototype.process=function(){this.body.position[0]=this.bx,this.body.angle=0,this.toUp&&(this.body.applyForceLocal([0,500*this.toUp],[0,0]),this.toUp=0)},t.prototype.createShape=function(){return new p2.Circle({radius:BALL_SIZE_METER/2})},t.prototype.createDisplay=function(){var e=new egret.Shape;return e.graphics.beginFill(Palette.Ball),e.graphics.lineStyle(5,Palette.BallBorder),e.graphics.drawCircle(0,0,GameWorld.meterToPixel(BALL_SIZE_METER/2)),e.graphics.endFill(),e},t.prototype.onImpact=function(e){var t=GameWorld.getGameObject("Ground"),r=GameWorld.getGameObject("TimeGauge");return e.id===t.id?(r.reduceByCourseOut(),!1):!0},t.prototype.onEndContact=function(e,t,r){if(!(e instanceof Basket))return!0;this.toPassBasket=0;var i=e.hit(r,this.body.position);if(0===i)return!1;if(i===this.toPassBasketSide)return console.log("XXXXX TOUCH "+e.id+"("+i+")"),!1;console.log("OOOOO PASS "+e.id+"("+i+")"),this.createEffect();var n=GameWorld.getGameObject("ScoreUi");return n.countup(),SoundManager.playSuccess(),!1},t.prototype.onBeginContact=function(e,t,r){if(!(e instanceof Basket))return!0;var i=e.hit(r,this.body.position);return 0===i?!1:(this.toPassBasket=e.id,this.toPassBasketSide=i,!1)},t.prototype.createEffect=function(){this.particle.emitterX=this.egretX,this.particle.emitterY=this.egretY,this.display.parent.addChild(this.particle),this.particle.start(500)},t}(PhysicsObject);__reflect(Ball.prototype,"Ball");var Basket=function(e){function t(){var t=e.call(this)||this;return t.lengthMeter=BALL_SIZE_METER+BASKET_SIZE_METER+random(.1,.5),t.halfLengthMeter=t.lengthMeter/2,t.velocityX=random(-2.5,-1),t}return __extends(t,e),t.prototype.options=function(){var e=random(2,7);return{gravityScale:0,mass:400,position:[10,e],velocity:[this.velocityX,0],type:p2.Body.KINEMATIC}},t.prototype.createDisplay=function(){var e=GameWorld.xMeterToPixel(0-this.halfLengthMeter),t=GameWorld.xMeterToPixel(0+this.halfLengthMeter),r=new egret.Shape,i=r.graphics;return i.beginFill(Palette.BasketRim,1),i.lineStyle(5,Palette.BasketNet),i.moveTo(e,0),i.lineTo(t,0),i.lineStyle(5,Palette.BasketRimBorder),i.drawCircle(e,0,GameWorld.meterToPixel(BASKET_SIZE_METER)),i.drawCircle(t,0,GameWorld.meterToPixel(BASKET_SIZE_METER)),i.endFill(),r},t.prototype.addShapeToBody=function(){var e=new p2.Circle({radius:BASKET_SIZE_METER}),t=new p2.Circle({radius:BASKET_SIZE_METER});this.line=new p2.Line({length:2*this.halfLengthMeter}),this.line.sensor=!0,this.body.addShape(e,[-this.halfLengthMeter,0]),this.body.addShape(t,[+this.halfLengthMeter,0]),this.body.addShape(this.line,[0,0])},t.prototype.process=function(){this.body&&this.body.position[0]<-1&&this.markToDelete()},t.prototype.hit=function(e,t){if(e.id!==this.line.id)return 0;var r=this.body.angle,i=Math.cos(r),n=Math.sin(r),o=t[0]-this.body.position[0],a=t[1]-this.body.position[1],s=i*a-n*o;return 0>s?1:-1},t}(PhysicsObject);__reflect(Basket.prototype,"Basket");var BasketManager=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.lastBasketCreation=2e3,t}return __extends(t,e),t.prototype.process=function(){this.lastBasketCreation+=1e3/FPS;var e=Math.random();2e3<this.lastBasketCreation&&.05>e&&(new Basket,this.lastBasketCreation=0)},t}(GameObject);__reflect(BasketManager.prototype,"BasketManager");var BASKET_SIZE_METER=.15,BALL_SIZE_METER=.6,FPS=60,GameMain=function(){function e(){}return e.destroy=function(){GameWorld.destroy()},e.start=function(e,t){var r=egret.MainContext.instance.stage.stageWidth/10;GameWorld.init(r/BALL_SIZE_METER,e),new Sky,new Ground,new TimeGauge(30),new ScoreUi;var i=new Ball;e.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(e){return i.up()},this);new BasketManager;GameWorld.on("gameover",function(){SoundManager.playGameOver(),GameWorld.pause(),t()}),GameWorld.start()},e}();__reflect(GameMain.prototype,"GameMain");var GameWorld=function(){function e(){}return e.getGameObject=function(e){var t=this.namedObjects[e];if(t)return t;throw new Error("GameObject'"+e+"' is not found")},e.addGameObject=function(e){this.objects.push(e);var t=e.name;if(t){if(this.namedObjects[t])throw new Error("GameObject'"+t+"' already exists");this.namedObjects[t]=e}},e.addPhysicsObject=function(e){this.world.addBody(e.body),this.physicsObjects[e.id]=e},e.destroy=function(){var e=this;setTimeout(function(){console.log("GameWorld#destroy -> setInterval"),e.objects.forEach(function(e){return e["delete"]()}),e.objects=[],e.physicsObjects={},e.namedObjects={},e.world.clear()},1)},e.pixelToMeter=function(e){return e/this.pixelPerMeter},e.meterToPixel=function(e){return e*this.pixelPerMeter},e.xMeterToPixel=function(e){return this.meterToPixel(e)},e.yMeterToPixel=function(e){return this.stageHeight-this.meterToPixel(e)},e.init=function(e,t){this.pixelPerMeter=e,this.meterPerPixel=1/e,this.stageHeight=egret.MainContext.instance.stage.stageHeight,this.stageWidth=egret.MainContext.instance.stage.stageWidth,this.stageHeightMeter=this.pixelToMeter(this.stageHeight),this.stageWidthMeter=this.pixelToMeter(this.stageWidth),this.displayObjectContainer=t;var r=new p2.World;r.sleepMode=p2.World.BODY_SLEEPING,r.gravity=[0,-9.8],this.world=r},e.emit=function(e,t){null!==this.callback&&this.callback(t)},e.on=function(e,t){this.callback=t},e.start=function(){var e=this;this.world.on("impact",function(t){var r=e.physicsObjects[t.bodyA.id],i=e.physicsObjects[t.bodyB.id];r.onImpact(i)!==!1&&i.onImpact(r)===!1}),this.world.on("beginContact",function(t){var r=e.physicsObjects[t.bodyA.id],i=e.physicsObjects[t.bodyB.id];r.onBeginContact(i,t.shapeA,t.shapeB)!==!1&&i.onBeginContact(r,t.shapeB,t.shapeA)===!1}),this.world.on("endContact",function(t){var r=e.physicsObjects[t.bodyA.id],i=e.physicsObjects[t.bodyB.id];r.onEndContact(i,t.shapeA,t.shapeB)!==!1&&i.onEndContact(r,t.shapeB,t.shapeA)===!1}),this.loop=function(t){var r=1e3/FPS;e.world.step(1/60,r/1e3,10);for(var i=e.objects.length,n=0;i>n;n++){var o=e.objects[n];o.inited||o.toDelete||o.init()}for(var a=!1,n=0;i>n;n++){var o=e.objects[n];o.inited&&!o.toDelete&&o.process()}for(var n=0;i>n;n++){var o=e.objects[n];o.toDelete?a=!0:o.inited&&o.update()}a&&(e.objects=e.objects.filter(function(e){return e.toDelete?(e["delete"](),!1):!0}))},this.displayObjectContainer.addEventListener(egret.Event.ENTER_FRAME,this.loop,this)},e.pause=function(){this.displayObjectContainer.removeEventListener(egret.Event.ENTER_FRAME,this.loop,this)},e.objects=[],e.namedObjects={},e.physicsObjects={},e}();__reflect(GameWorld.prototype,"GameWorld");var Ground=function(e){function t(){return e.call(this,"Ground")||this}return __extends(t,e),t.prototype.options=function(){return{position:[GameWorld.stageWidthMeter/2,0],type:p2.Body.STATIC}},t.prototype.addShapeToBody=function(){var e=GameWorld.stageWidthMeter;this.body.addShape(new p2.Box({width:e,height:1}),[0,.5]),this.body.addShape(new p2.Box({width:e,height:1}),[0,GameWorld.stageHeightMeter-.5]),this.body.damping=1},t.prototype.createDisplay=function(){var e=GameWorld.stageWidth,t=GameWorld.meterToPixel(1),r=new egret.Shape,i=r.graphics;return i.beginFill(Palette.Ground),i.drawRect(-e/2,-t,e,t),i.drawRect(-e/2,-GameWorld.stageHeight,e,t),r.graphics.endFill(),r},t.prototype.process=function(){},t}(PhysicsObject);__reflect(Ground.prototype,"Ground");var Palette=function(){function e(){}return e.Primary=4898220,e.Secondary=16534042,e.BackgroundA=16222003,e.BackgroundB=16355910,e.SecondaryOpposite=14671075,e.TitleBackground=e.Primary,e.TitleText=e.SecondaryOpposite,e.Ball=e.Primary,e.BallBorder=e.SecondaryOpposite,e.BasketRim=e.Secondary,e.BasketRimBorder=e.SecondaryOpposite,e.BasketNet=e.SecondaryOpposite,e.Ground=e.Secondary,e.SkyA=e.BackgroundA,e.SkyB=e.BackgroundA,e.TimeGauge=e.SecondaryOpposite,e.Score=e.SecondaryOpposite,e.GameOverBackground=e.SecondaryOpposite,e.GameOverText=e.Secondary,e}();__reflect(Palette.prototype,"Palette");var ScoreUi=function(e){function t(){var t=e.call(this,"ScoreUi")||this;return t.score=0,t}return __extends(t,e),t.prototype.reset=function(){this.score=0},Object.defineProperty(t.prototype,"lastScore",{get:function(){return this.score},enumerable:!0,configurable:!0}),t.prototype.countup=function(){this.score++,this.textField.text=this.score.toString()},t.prototype.createDisplay=function(){return this.textField=new egret.TextField,this.textField.x=GameWorld.stageWidth/2,this.textField.y=120,this.textField.size=60,this.textField.textAlign="center",this.textField.textColor=Palette.Score,this.textField},t.prototype.process=function(){},t}(GameObject);__reflect(ScoreUi.prototype,"ScoreUi");var Sky=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.createDisplay=function(){var e=new egret.Sprite,t=e.graphics;t.clear(),t.beginFill(Palette.BackgroundA),t.drawRect(0,0,GameWorld.stageWidth,GameWorld.stageHeight),t.endFill();var r=GameWorld.stageWidth/6;t.beginFill(Palette.BackgroundB);for(var i=0;6>i;i++)t.drawRect(r*i,0,r/2,GameWorld.stageHeight);return t.endFill(),e},t.prototype.process=function(){},t}(GameObject);__reflect(Sky.prototype,"Sky");var SoundManager=function(){function e(){}return e.init=function(){this.inited||(this.buttonPressed=RES.getRes("btn_mp3"),this.gameOver=RES.getRes("gameover_mp3"),this.success=RES.getRes("success_mp3"),this.inited=!0)},e.playButtonPressed=function(){this.buttonPressed.play(0,1)},e.playGameOver=function(){this.gameOver.play(0,1)},e.playSuccess=function(){this.success.play(0,1)},e.inited=!1,e}();__reflect(SoundManager.prototype,"SoundManager");var TimeGauge=function(e){function t(t){void 0===t&&(t=30);var r=e.call(this,"TimeGauge")||this;return r.courseOut=!1,r.remainedSecondOnStart=t,r.restTimeMiliseconds=1e3*t,r}return __extends(t,e),t.prototype.createDisplay=function(){var e=new egret.Sprite,t=e.graphics;return t.clear(),t.lineStyle(5,Palette.TimeGauge),t.beginFill(0,0),t.drawRect(30,30,GameWorld.stageWidth-60,60),t.endFill(),this.isTimeOver()||(t.lineStyle(0),t.beginFill(Palette.TimeGauge),t.drawRect(40,40,(GameWorld.stageWidth-80)*this.restTimeMiliseconds/this.remainedSecondOnStart/1e3,40),t.endFill()),e},t.prototype.isTimeOver=function(){return this.restTimeMiliseconds<=0},t.prototype.reduceByCourseOut=function(){this.courseOut=!0},t.prototype.process=function(){this.courseOut?(this.restTimeMiliseconds-=3e3,this.courseOut=!1):this.restTimeMiliseconds-=1e3/FPS,this.resetDisplay(),this.isTimeOver()&&GameWorld.emit("gameover")},t}(GameObject);__reflect(TimeGauge.prototype,"TimeGauge");var GameOverScene=function(e){function t(t){var r=e.call(this)||this;return r.lastScore=t,r.addEventListener(eui.UIEvent.COMPLETE,r.uiCompHandler,r),r.skinName="resource/custom_skins/GameOverScene.exml",r}return __extends(t,e),t.prototype.uiCompHandler=function(){var e=this;this.lastScoreLabel.text=""+this.lastScore,this.addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){SoundManager.playButtonPressed(),GameMain.destroy(),e.parent.addChild(new TitleScene),e.parent.removeChild(e)},this)},t}(eui.Component);__reflect(GameOverScene.prototype,"GameOverScene",["eui.UIComponent","egret.DisplayObject"]);var GameScene=function(e){function t(){var t=e.call(this)||this;return t.once(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t}return __extends(t,e),t.prototype.onAddToStage=function(){var e=this;GameMain.start(this.parent.stage,function(){var t=GameWorld.getGameObject("ScoreUi");e.parent.addChild(new GameOverScene(t.lastScore)),e.parent.removeChild(e)})},t}(egret.Sprite);__reflect(GameScene.prototype,"GameScene");