function random(t,e){return t+Math.random()*(e-t)}var __reflect=this&&this.__reflect||function(t,e,r){t.__class__=e,r?r.push(e):r=[e],t.__types__=t.__types__?r.concat(t.__types__):r},__extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o]);r.prototype=e.prototype,t.prototype=new r},__awaiter=this&&this.__awaiter||function(t,e,r,o){return new(r||(r=Promise))(function(i,n){function a(t){try{l(o.next(t))}catch(e){n(e)}}function s(t){try{l(o["throw"](t))}catch(e){n(e)}}function l(t){t.done?i(t.value):new r(function(e){e(t.value)}).then(a,s)}l((o=o.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function r(t){return function(e){return o([t,e])}}function o(r){if(i)throw new TypeError("Generator is already executing.");for(;l;)try{if(i=1,n&&(a=n[2&r[0]?"return":r[0]?"throw":"next"])&&!(a=a.call(n,r[1])).done)return a;switch(n=0,a&&(r=[0,a.value]),r[0]){case 0:case 1:a=r;break;case 4:return l.label++,{value:r[1],done:!1};case 5:l.label++,n=r[1],r=[0];continue;case 7:r=l.ops.pop(),l.trys.pop();continue;default:if(a=l.trys,!(a=a.length>0&&a[a.length-1])&&(6===r[0]||2===r[0])){l=0;continue}if(3===r[0]&&(!a||r[1]>a[0]&&r[1]<a[3])){l.label=r[1];break}if(6===r[0]&&l.label<a[1]){l.label=a[1],a=r;break}if(a&&l.label<a[2]){l.label=a[2],l.ops.push(r);break}a[2]&&l.ops.pop(),l.trys.pop();continue}r=e.call(t,l)}catch(o){r=[6,o],n=0}finally{i=a=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}var i,n,a,s,l={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:r(0),"throw":r(1),"return":r(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},e.prototype.onProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var BASKET_SIZE_METER=.15,BALL_SIZE_METER=.6,Main=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(t){var e=egret.MainContext.instance.stage.stageWidth/10;GameWorld.init(e/BALL_SIZE_METER,this.stage),new Sky,new Ground;var r=new Ball;this.stage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(t){return r.up()},this);var o=2e3;GameWorld.start(function(t){o+=t;var e=Math.random();o>2e3&&.05>e&&(new Basket,o=0)})},e}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");var GameWorld=function(){function t(){}return t.pixelToMeter=function(t){return t/this.pixelPerMeter},t.meterToPixel=function(t){return t*this.pixelPerMeter},t.xMeterToPixel=function(t){return this.meterToPixel(t)},t.yMeterToPixel=function(t){return this.stageHeight-this.meterToPixel(t)},t.init=function(t,e){this.pixelPerMeter=t,this.meterPerPixel=1/t,this.stageHeight=egret.MainContext.instance.stage.stageHeight,this.stageWidth=egret.MainContext.instance.stage.stageWidth,this.stageHeightMeter=this.pixelToMeter(this.stageHeight),this.stageWidthMeter=this.pixelToMeter(this.stageWidth),this.displayObjectContainer=e;var r=new p2.World;r.sleepMode=p2.World.BODY_SLEEPING,r.gravity=[0,-9.8],this.world=r},t.start=function(t){var e=this,r=function(r){if(!(10>r||r>1e3)){e.world.step(1/60,r/1e3,10);for(var o=e.objects.length,i=0;o>i;i++){var n=e.objects[i];n.inited||n.toDelete||n.init()}for(var a=!1,i=0;o>i;i++){var n=e.objects[i];n.inited&&!n.toDelete&&n.process()}t&&t(r);for(var i=0;o>i;i++){var n=e.objects[i];n.toDelete?a=!0:n.inited&&n.update()}a&&(e.objects=e.objects.filter(function(t){return t.toDelete?(t["delete"](),!1):!0}))}};egret.Ticker.getInstance().register(r,this.displayObjectContainer)},t.objects=[],t}();__reflect(GameWorld.prototype,"GameWorld");var GameObject=function(){function t(){this.toDelete=!1,this.inited=!1,GameWorld.objects.push(this)}return t.prototype.init=function(){this.display=this.createDisplay(),GameWorld.displayObjectContainer.addChild(this.display),this.inited=!0},t.prototype.update=function(){},t.prototype.markToDelete=function(){this.toDelete=!0},t.prototype["delete"]=function(){GameWorld.displayObjectContainer.removeChild(this.display)},t}();__reflect(GameObject.prototype,"GameObject");var PhysicsObject=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.init=function(){t.prototype.init.call(this),this.body=new p2.Body(this.options()),this.addShapeToBody(),this.body.displays=[this.display],GameWorld.world.addBody(this.body)},e.prototype.addShapeToBody=function(){var t=this.createShape();this.body.addShape(t)},e.prototype.createShape=function(){throw new Error("createShape or addShapeToBody must be implemented")},e.prototype.update=function(){var t=this.body,e=this.display;e&&(e.x=GameWorld.xMeterToPixel(t.position[0]),e.y=GameWorld.yMeterToPixel(t.position[1]),e.rotation=360-180*(t.angle+t.shapes[0].angle)/Math.PI)},e.prototype["delete"]=function(){t.prototype["delete"].call(this),GameWorld.world.removeBody(this.body),this.body.displays=[],this.body=null},e}(GameObject);__reflect(PhysicsObject.prototype,"PhysicsObject");var Sky=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.options=function(){return{type:p2.Body.KINEMATIC}},e.prototype.createDisplay=function(){var t=new egret.Sprite,e=t.graphics;return e.clear(),e.beginFill(8421631,1),e.drawRect(0,0,GameWorld.stageWidth,GameWorld.stageHeight),e.endFill(),e.beginFill(12632319),e.drawCircle(0,0,GameWorld.stageWidth),t},e.prototype.process=function(){},e}(GameObject);__reflect(Sky.prototype,"Sky");var Ball=function(t){function e(){var e=t.call(this)||this;return e.toUp=0,e.bx=GameWorld.stageWidthMeter/4,e}return __extends(e,t),e.prototype.options=function(){return{mass:1,force:[0,-300],position:[this.bx,GameWorld.stageHeightMeter/2]}},e.prototype.up=function(){this.toUp++},e.prototype.process=function(){this.body.position[0]=this.bx,this.body.angle=0,this.toUp&&(this.body.applyForceLocal([0,500*this.toUp],[0,0]),this.toUp=0)},e.prototype.createShape=function(){return new p2.Circle({radius:BALL_SIZE_METER/2})},e.prototype.createDisplay=function(){var t=new egret.Shape;return t.graphics.beginFill(16711680),t.graphics.drawCircle(0,0,GameWorld.meterToPixel(BALL_SIZE_METER/2)),t.graphics.endFill(),t},e}(PhysicsObject);__reflect(Ball.prototype,"Ball");var Ground=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.options=function(){return{position:[0,1],type:p2.Body.STATIC}},e.prototype.createShape=function(){return new p2.Plane({angle:Math.PI})},e.prototype.createDisplay=function(){var t=new egret.Shape;return t.graphics.beginFill(4194304),t.graphics.drawRect(0,0,GameWorld.stageWidth,GameWorld.meterToPixel(1)),t.graphics.endFill(),t},e.prototype.process=function(){},e}(PhysicsObject);__reflect(Ground.prototype,"Ground");var Basket=function(t){function e(){var e=t.call(this)||this;return e.lengthMeter=BALL_SIZE_METER+BASKET_SIZE_METER+random(.1,.5),e.halfLengthMeter=e.lengthMeter/2,e.velocityX=random(-2.5,-1),e}return __extends(e,t),e.prototype.options=function(){return{gravityScale:0,mass:40,position:[10,random(2,7)],velocity:[this.velocityX,0]}},e.prototype.createDisplay=function(){var t=GameWorld.xMeterToPixel(0-this.halfLengthMeter),e=GameWorld.xMeterToPixel(0+this.halfLengthMeter),r=new egret.Shape,o=r.graphics;return o.beginFill(16776960,1),o.drawCircle(t,0,GameWorld.meterToPixel(BASKET_SIZE_METER)),o.drawCircle(e,0,GameWorld.meterToPixel(BASKET_SIZE_METER)),o.lineStyle(5,16773120,.5),o.moveTo(t,0),o.lineTo(e,0),o.endFill(),r},e.prototype.addShapeToBody=function(){var t=new p2.Circle({radius:BASKET_SIZE_METER}),e=new p2.Circle({radius:BASKET_SIZE_METER});this.body.addShape(t,[-this.halfLengthMeter,0]),this.body.addShape(e,[+this.halfLengthMeter,0])},e.prototype.process=function(){this.body&&this.body.position[0]<-1&&this.markToDelete()},e}(PhysicsObject);__reflect(Basket.prototype,"Basket");var DebugPlatform=function(){function t(){}return t.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,{nickName:"username"}]})})},t.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);